# Checkpoint Arena Image and Metadata Generation

This repository contains the input data and generation script for [Checkpoint Arena](https://checkpoint-arena.com).

## File Structure

* `generate.py` - main generator script
* `data.py` - prompt and checkpoint data
* `comfy_ui_input.json` - base input graph for ComfyUI image generation
* `out/*.json` - the latest metadata output generated by the script
* `avif/*.avif` - where generated images are stored
* `avif/thumb/*.avif` - where the corresponding thumbnails are stored

## Requirements

Requires a fully set up ComfyUI installation, running at the default port.
The path to this must be configured in `generate.py` (`output_dir`).

Of course, all checkpoints for which images are to be generated must also be installed.

ImageMagick is required for thumbnail generation, and npm "avif" is required for avif conversion.

## Process Overview

The generation process works as follows:

1. Iterate over the cross product of all prompts, checkpoints, and negative prompt options. For each of them:
   1. Generate a unique ID
   2. Set up the options in the ComfyUI json prompt
   3. If an image for a given target seed has not yet been generated:
      * Queue the corresponding generation prompt to ComfyUI
   4. Wait for the image generation to complete
   5. Also generate the metadata for this set of images
2. Output metadata as json to `out`
3. Convert all generated `.png`s to `.avif` and copy to the `avif/` folder
4. Build thumbnails from the `.png`s, and also convert and copy those
